<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>anexo8-pag44-ej1</title>
</head>

<body>

    <!-- Utiliza jquery ui para: crear una página que muestre una tabla de contactos indicando dni, Nombre y Telefono
que muestre por defecto el contacto “11111111A”, Administrador, 555-000-001.
Al final de la tabla debe mostrarse un botón “Añadir”, y a la derecha de cada contacto en la
tabla otro botón “Eliminar”:
Cuando el usuario pulse el botón “Añadir” debe mostrarse un cuadro de diálogo con un
formulario en el que el usuario introduzca el dni, nombre y teléfono de un nuevo contacto. El
cuadro de diálogo debe mostrar un botón “OK” para confirmar el alta, y otro “Cancelar”:
Cuando el usuario pulsa el botón “OK” debe comprobarse que se haya introducido un valor en
las tres cajas de texto. De no ser así, debe teñirse de rojo la caja vacía y mostrar un mensaje
indicativo a su lado derecho:
Si el usuario ha introducido datos en todas las cajas de texto al pulsar el botón “OK” debe
cerrarse el cuadro de diálogo y añadir los datos del nuevo contacto a la tabla de la página
incluyendo el botón “Eliminar”.
Al pulsar el botón “Eliminar” de una fila, ésta debe eliminarse de la tabla solicitando antes una
confirmación mostrando el nombre y dni del usuario.
Si el usuario responde “Aceptar” debe eliminarse los datos del contacto de la tabla.  -->

    <div id="dialog-form" title="Crear nuevo contacto">
        <p class="validateTips">Todos los campos son obligatorios.</p>
        <form>
            <fieldset>
                <label for="name">DNI</label>
                <input type="text" name="name" id="name" class="text ui-widget-content ui-corner-all">
                <label for="dni">Nombre</label>
                <input type="text" name="dni" id="dni" value="" class="text ui-widget-content ui-corner-all">
                <label for="telefono">Teléfono</label>
                <input type="text" name="telefono" id="telefono" value="" class="text ui-widget-content ui-corner-all">
            </fieldset>
        </form>
       

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.js"></script>
        <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
        <link rel="stylesheet" href="./jquery-ui.css">
        <script>
            $(function () { 
                let dialog, form,   
                    name = $("#name"), //Obtengo el elemento con id name
                    dni = $("#dni"), //Obtengo el elemento con id dni
                    telefono = $("#telefono"), //Obtengo el elemento con id telefono
                    allFields = $([]).add(name).add(dni).add(telefono), //array de todos los campos
                    tips = $(".validateTips"); //mensaje de validación

                function updateTips(t) { //función para actualizar el mensaje de validación
                    tips
                        .text(t) //actualiza el texto
                        .addClass("ui-state-highlight"); //añade la clase ui-state-highlight
                    setTimeout(function () { //después de 1500ms
                        tips.removeClass("ui-state-highlight", 1000); //elimina la clase ui-state-highlight
                    }, 500);
                }

                function checkLength(escritoEnCampo, nombre, min, max) { //función para comprobar la longitud de un campo
 
                    if (escritoEnCampo.val().length < min || escritoEnCampo.val().length > max) {
                        escritoEnCampo.addClass("ui-state-error");
                        updateTips(`La longitud de ${nombre} debe estar entre ${min} y ${max}.`);
                        return false;
                    } else {
                        return true;
                    }
                }

                function checkRegexp(escritoEnCampo, regexp, n) { //función para comprobar la expresión regular de un campo
                    if (!(regexp.test(escritoEnCampo.val()))) { //si no coincide con la expresión regular
                        escritoEnCampo.addClass("ui-state-error"); //añade la clase ui-state-error
                        updateTips(n); //actualiza el mensaje de validación
                        return false; 
                    } else { 
                        return true; 
                    }
                }   

                function addUser() {
                    let valid = true;
                    allFields.removeClass("ui-state-error");

                    valid = valid && checkLength(name, "nombre", 3, 16);
                    valid = valid && checkLength(dni, "dni", 6, 80);
                    valid = valid && checkLength(telefono, "contraseña", 5, 16);

                    valid = valid && checkRegexp(name, /^[a-z]([0-9a-z_\s])+$/i, "El nombre puede consistir en a-z, 0-9, guiones bajos, espacios y debe comenzar con una letra.");
                    valid = valid && checkRegexp(dni, dniRegex, telefono);
                    valid = valid && checkRegexp(telefono, telefonoRegex, "La contraseña debe consistir en cualquier carácter a-z, 0-9 y debe tener entre 5 y 16 caracteres.");

                    if (valid) {
                        $("#users tbody").append("<tr>" +
                            "<td>" + name.val() + "</td>" +
                            "<td>" + dni.val() + "</td>" +
                            "<td>" + telefono.val() + "</td>" +
                            "<td><button class='eliminar'>Eliminar</button></td>" +
                            "</tr>");
                        dialog.dialog("close");
                    }
                    return valid;
                }

                dialog = $("#dialog-form").dialog({
                    autoOpen: false,
                    height: 400,
                    width: 350,
                    modal: true,
                    buttons: {
                        "Crear un usuario": addUser,
                        Cancel: function () {
                            dialog.dialog("close");
                        }
                    },
                    close: function () {
                        form[0].reset();
                        allFields.removeClass("ui-state-error");
                    }
                });

                form = dialog.find("form").on("submit", function (event) {
                    event.preventDefault();
                    addUser();
                });

                $("#create-user").button().on("click", function () {
                    dialog.dialog("open");
                });
            });
        </script>
    </div>

    <button id="create-user">Crear nuevo usuario</button>
    <table id="users" class="ui-widget ui-widget-content">
        <thead>
            <tr class="ui-widget-header ">
                <th><i class="fa fa-cc-diners-club" aria-hidden="true"></i></th>
                <th>Nombre</th>
                <th>Teléfono</th>
                <th>Eliminar</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>12345678A</td>
                <td>Pepe</td>
                <td>123456789</td>
                <td><button class="eliminar">Eliminar</button></td>
            </tr>
            <tr>
                <td>87654321B</td>
                <td>Manolo</td>
                <td>987654321</td>
                <td><button class="eliminar">Eliminar</button></td>
            </tr>
        </tbody>
    </table>
    <script>
        $(document).ready(function () {
            $(".eliminar").click(function () {
                let parent = $(this).parents().get(0);
                $(parent).remove();
            });
        });
    </script>

</body>

</html>